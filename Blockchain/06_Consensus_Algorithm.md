# 합의 알고리즘

---

[TOC]

---



## Overview

합의 알고리즘(Consensus Algorithm)은 다수의 참여자들이 통일된 의사결정을 하기 위해 사용하는 알고리즘을 말하며, 합의 모델, 합의 방식, 합의 메커니즘, 합의 프로토콜로도 불린다.

블록체인의 데이터는 흩어져 있는 수많은 노드에 보관되기 때문에, 각각의 노드들은 블록의 데이터가 원본이라는 것을 상호간에 합의하는 과정이 필요하다. 네트워크를 올바른 방향으로 이끌고자하는 다수의 노드들이 상호 검증을 거쳐 올바른 블록 생성을 이끌어내는 프로세스와 알고리즘을 바로 합의(Consensus)라고 한다.

여기서는 합의 알고리즘의 종류에 무엇이 있는지 알아본다.

|                                  | 작업증명<br />Proof of Work(PoW) |     지분증명<br />Proof of Stake(PoS)      |   Byzantine Fault Tolerance(BFT)    |
| :------------------------------: | :------------------------------: | :----------------------------------------: | :---------------------------------: |
|      **제안자격 취득방법**       |  목표값 이하의 해시를 찾는 작업  | 플랫폼 토큰을 보유한 양과 기간에 따라 결정 | 정해진 순번 또는 정해진 확률에 의해 |
|      **네트워크 참여 제한**      |               없음               |                없거나 낮음                 |                높음                 |
| **합의에 필요한 연산량 및 비용** |               높음               |                    낮음                    |                낮음                 |
|             **위험**             |             51% 공격             |                  51% 공격                  |                담합                 |
|      **대표적인 블록체인**       |        비트코인, 이더리움        |                casper, EOS                 |            Hyeperledger             |

(신원 확인을 하려는 경우, 공개키를 암호화하여 사용한다.)



## 작업증명(PoW)

작업 증명(Proof of Work)은 사토시 나카모토가 제안한 합의 알고리즘으로, 블록생성 시간 동안 가장 많은 **해시파워**를 제공한 노드가 블록을 생성할 수 있도록 설계가 되었다. 블록을 생성하기 위해 논스(nonce)라는 임의의 값을 맞히는 과정을 채굴(mining)이라고 한다. 작업증명에서는 브랜치가 생긴 경우 가장 긴 블록체인이 남을 때까지 서로 경쟁하여 이긴 브랜치가 최종적인 브랜치로 채택이 되며, 다른 브랜치는 버려진다.

작업 증명은 현재 **시빌 공격(Sybil Attack)**과 같은 블록체인 네트워크에 대한 각종 공격을 막을 수 있다고 증명된 유일한 알고리즘이다.

> 시빌공격: 공격자가 실제로는 한 명이면서, 마치 여러 명인 것처럼 속이는 방식으로 네트워크 상의 여러 노드를 제어함으로써, 의사결정에 좋지 않은 영향을 미치는 공격

**장점**

- 현재 높은 시장 가치를 형성하고 있는 주류 코인들이 채택하고 있다.
- 강력한 보안성을 제공한다.
- 서비스 남용을 쉽게 방지할 수 있다.

**단점**

- 높은 전력 소모를 통해 자원을 낭비한다.
- 지속적으로 해시파워를 유지해야 한다.
- 특정 마이닝 세력의 해시 독점으로 인한 생태계 교란 우려가 있다.
- 느린 트랜잭션
- 51% 공격의 위험성

```markdown
51% 공격이란 블록체인의 전체 노드 중 50%를 초과하는 해시 연산력을 확보한 뒤, 거래 정보를 조작함으로써 이익을 얻으려는 해킹 공격이다.
```

**사용 코인**: 비트코인, 라이트코인

**유형**: 퍼블릭 비허가형 공개형



## 지분증명(PoS)

지분 증명(Proof of Stake) 알고리즘은 지분을 많이 가지고 있는 노드에게 블록을 생성할 권한을 준다. 소유 지분 양에 비례하여 블록 생성 권한을 높은 확률로 부여 받는다.

채굴자에게는 이자와 같은 방식으로 코인이 지급되며, 일정 수 이상의 코인을 보관하고 있는 지갑을 블록체인 네트워크에 연결시켜놓기만 하면 보상을 받을 수 있다. 블록 생성자와 지분 생성자의 이해관계를 일치시킴으로써 블록을 나쁜 의도로 생성할 동기부여를 업애며, 잘못 생성할 경우 패널티를 부여한다.

**장점**

- 해시 파워가 많이 필요하지 않으므로 경제적(빠른 트랜잭션)이며 친환경적이다.
- 블록 생산자의 탈중앙화로 안정성을 확보할 수 있다.
- 블록을 생성하기 위해 지분을 담보로 잡아야하기 때문에 dumping을 방지할 수 있다.
- 51% 공격에 내성

**단점**

- 보안성이 아직 검증되지 않았다.
- 지분이 많은 고래들이 권력을 독점할 가능성이 존재한다.

**사용 코인**: 퀀텀 네오, 스트라디스

**유형**: 퍼블릭 비허가형 공개형



## 위임지분증명(DPoS)

위임 지분 증명(Delegated Proof of Stake)은 PoS에서 변형된 것으로, 시스템의 지분을 가진 각 노드가 투표를 통해 트랜잭션의 유효성 검사를 다른 노드에 위임하여 증명하는 개념이다. 투표에서 선출된 노드는 상위 노드 혹은 witness(증인)이라고 지칭한다.

**장점**

- POS에 비해 많은 트랜잭션을 빠르게 처리 가능하다.
- POW에 비해 비용이 낮다.
- 하드포크의 위험이 낮다.
- 증인들이 투표에 참여할 인센티브가 분명하다.

**단점**

- 증인끼리 손쉽게 담합할 위험이 있다.
- 공개된 소수의 증인에 대한 DDos 공격 위험이 있다.
- 탈중앙성 부족

**사용 코인**: 스팀 이오스, 아크 라이즈

**유형**: 퍼블릭 비허가형 공개형



## 비잔틴 장애 허용(BFT)

비잔틴 장애 허용(Byzantine Fault Tolerance)는 장애가 있더라도 전체의 3분의 1을 넘지 않는다면, 시스템이 정상 작동하도록 허용하는 합의 알고리즘이다.



## 프랙티컬 비잔틴 장애 허용(PBFT)

프랙티컬 비잔틴 장애 허용(Practical Byzantine Fault Tolerance)은 참가자 1명이 primary(리더)가 되어 모든 참가자에게 요청 송신 및 그 요청에 대한 결과를 집계한 뒤, 다수의 값을 사용해 블록을 확정하는 합의 알고리즘이다. 각 노드는 브로드캐스트된 명령을 받게 되면 모든 노드에 회신하고, 각 노드는 명령을 일정 수 이상 수신하면 명령을 실행하고 블록을 등록한다. PBFT는 네오, 질리카, 하이퍼레저, R3, ITC, 텐더민트 등에서 사용한다.

**장점**

- 완결성 문제 해결
- 빠른 트랜잭션

**단점**

- 참여자 사전 파악 필요
- 참가자 증가 시 성능 하락

**사용 코인**: 패브릭

**유형**: 프라이빗 허가형 컨소시엄



## 기타

### 경과시간증명(PoET)

경과시간증명은 경쟁적 연산으로 낭비되는 에너지를 줄이면서 작업 증명과 유사 효과를 가진다. 하이퍼레저 Sawtooth Lake에서 제안하였으며, 인텔 SGX를 기반으로 블록을 생성하는 리더를 랜덤으로 선정한다.

**장점**

- 검증된 방법의 개선
- 에너지 낭비 적음

**단점**

- 특정 HW 종속

**사용 코인**: 쏘투스(Sawtooth)

**유형**: 퍼블릭 비허가형 공개형

### 권한증명(PoA)

트랜잭션 및 블록의 validator라고 승인된 계정에 의해 유효성이 검사된다. Validator는 권리를 얻으므로 그 지위를 유지하고자하고, 자신의 신원에 부정적 평판이 생기길 워하지 않도록 노력할 것이라는 가정을 바탕으로 한다.

**유형**: 프라이빗 허가형 컨소시엄

### PAXOS

트랜잭션 및 블록의 validator라고 승인된 계정에 의해 유효성이 검사된다. Validator는 권리를 얻으므로 그 지위를 유지하고자하고, 자신의 신원에 부정적 평판이 생기길 워하지 않도록 노력할 것이라는 가정을 바탕으로 한다.

**유형**: 프라이빗 허가형 컨소시엄

### RAFT

리더를 선정한 후 시스템의 모든 변화를 리더를 통해 결정하는 방식으로, 신뢰된 네트워크에서만 사용한다.

**단점**

- 리더의 조작 가능성
- BTF를 보장하지 않음

**유형**: 프라이빗 허가형 컨소시엄

### Sieve

IBM에서 고안한 PBFT 확장 알고리즘으로, 실행 결과 전송 및 집계 결과 전송으로 흐름이 나뉜다.

**유형**: 프라이빗 허가형 컨소시엄



***Copyright* © 2022 Song_Artish**