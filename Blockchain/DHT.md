# Distributed Hash Table

---

[TOC]

---



## Hash Table

해시테이블(Hash Table)은 해시함수(hash function)를 사용하여 변환한 해시(hash)를 색인(index)으로 삼아 key와 value를 저장하는 자료구조이다.

### 구조

- **키(key)**: 고유한 값으로 해시 함수의 입력값이 된다. 다양한 길이의 값이 들어올 수 있으며, 해시 함수를 통해 변환하지 않은 상태로 저장소에 저장이 되면 다양한 길이만큼의 저장소를 구성해두어야 하므로 해시 함수로 값을 바꾸어 저장하게 된다.
- **해시함수(Hash Function)**: key를 hash로 바꿔주는 역할을 한다.단, 서로 다른 key가 같은 hash가 되는 **해시 충돌(Hash Collision)** 확률을 줄이는 것이 중요하다.
- **해시(Hash)**: key는 hash function을 사용해 만들어진 결과물로, 저장소에서 value와 매칭되어 저장된다. 변환된 값을 배열의 색인(index)과 같이 사용하게 된다.
- **데이터(Value)**: 저장소에 최종적으로 저장되는 값으로 색인(index)과 매칭되어 저장된다.

### 특징

- 저장, 삭제, 검색 과정 모두 평균적으로 O(1)의 시간복잡도를 가지고 있어, 데이터를 다루는 작업이 매우 빠르다.
- 해시 충돌이 발생할 수 있으며, 데이터 저장 전 저장공간을 미리 만들어놔야하기 때문에 공간 효율성이 떨어진다.
- 해시함수의 의존도가 높아, 해시 함수가 복잡하면 해시값을 만들어내는데 많은 시간이 소요된다.

### 저장, 삭제, 검색 과정

Hash Table에서 값을 저장, 삭제, 검색하기 위해서는 해시 함수에 key 값을 넣어 해시값을 만들게 된다. 이후 만들어진 해시값과 일치하는 index를 찾아 저장/삭제/검색한다.

기본적으로 저장/삭제/검색 작업들의 시간복잡도는 O(1)이다. 하지만 해시 충돌이 발생한 경우, 저장소의 모든 index 혹은 value(데이터)를 찾아봐야 하므로 O(n)이 딘다.



## 해시 알고리즘

- **Division Method**: Number type의 key를 저장소의 크기로 나누어, 나온 나머지를 index로 사용하는 방법이다. 이때 저장소의 크기를 Prime Number(소수)로 정하고 2의 제곱수와 먼 값을 사용하는 것이 효과가 좋다. 예를 들어 key 값이 23일 때, 테이블 크기가 7이라면 index는 2가 된다.

- **Digit Folding**: key의 문자열을 ASCII 코드로 바꾸고 그 값을 합해 저장소에서 index로 사용하는 방법이다. 만약 이때 index가 저장소의 크기를 넘어간다면 `Division Method`를 적용할 수 있다.

- **Multiplication Method**: 숫자로 된 key 값 K와 0과 1 사이의 실수 A, 보통 2의 제곱수인 m을 사용하여 다음과 같이 계산한 값을 사용한다.
  $$
  index = (KA mod 1)m
  $$

- **Universal Hashing**: 다수의 해시함수를 만들어  특정한 장소에 넣어두고, 무작위로 해시함수를 선택해 해시값을 만드는 기법이다.



## 해시 충돌 해결법

### Open Addressing(개방 연결법)

#### Linear Probing

선형 프로빙은 **충돌이 발생할 경우 빈 slot이 나올 때까지 탐색 후, 빈 slot이 나오면 위치가 결정**된다.
$$
h(k, i) = (h'(k)+i) mod m
$$
(여기서 k는 key, i는 충돌 횟수, h()는 해시 함수, m은 해시 테이블 크기)

구현은 매우 쉬우나 primary clustering 문제가 있다.

> **Primary Clustering**: 한 번 충돌이나면 집중적으로 충돌이 발생하는 것을 의미하여, 이로 인해 평균 검색 시간이 증가한다.

#### Quadratic Probing

이차식 프로빙은 다음과 같은 해시 함수를 사용한다. i에 대한 2차 함수 꼴로 slot을 이동하면서 빈 slot을 찾는다.
$$
h(k, i) = (h'(k) + c_1i+c_2i^2) mod m
$$
(여기서 h는 보조 해시 함수, c1, c2는 0이 아닌 상수)

선형 프로빙(Linear Probing)에 비해 충돌은 적지만, secondary clustering이 발생한다.

> **Secondary Clustering**: 처음 충돌한 위치가 같다면 다음 충돌할 위치도 반복적으로 계속 충돌이 나게 되는 것

#### Double Hashing Probing

이중 해시는 다음과 같은 형태의 해시 함수를 사용한다. 충돌이 없을 때는 h1으로 위치를 탐색하고, 충돌이 있으면 `h_2 mod m`만큼 이동하면서 탐색한다.
$$
h(k, i) = (h_1(k) + ih_2(k)) mod m
$$

### Separate Chaining(분리 연결법)

**충돌 시 연결 리스트에 추가하는 방식**이다. 이 방법은 연결 리스트로 인해 최악의 경우 수행 시간이 O(n)이 된다.



***Copyright* © 2022 Song_Artish**